.. role:: red 
.. role:: blue 
.. role:: remark
.. role:: worktodo

.. _Actor model: https://en.wikipedia.org/wiki/Actor_model
.. _kotlinUnibo: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html

.. _Data, Types and Variables: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#data
.. _Functions: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#fun
.. _Using lambda: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#lambda
.. _Closures, Callbacks and CPS: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#clos
.. _Towards Asynchronous Programming: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#async
.. _Introduction to coroutines: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#coroutinesIntro
.. _Dispatchers: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#dispatchers
.. _Suspending functions: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#suspend
.. _Kotlin Channels: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#channels
.. _Producers-consumers in Kotlin: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#kotlinprodcons
.. _Kotlin Actors: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#actors
.. _Sequences (suspendable): ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#sequences
.. _Classes and Objects in Kotlin: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#classes 
.. _Kotlin object: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#kotlinObject 
.. _Kotlin class: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#kotlinclass 
.. _Property delegation: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#propdeleg 
.. _Delegated properties: https://kotlinlang.org/docs/delegated-properties.html

.. _Kotlin data class: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#dataclass 
.. _Companion object: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#companionobj 
.. _Enum Classes: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#enumclass 
.. _Enum class: https://kotlinlang.org/docs/enum-classes.html
.. _About initializazion: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#ill 
.. _Inheritance: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#inheritance 
.. _Sealed clsss: ../../../../../it.unibo.kotlinIntro/userDocs/LabIntroductionToKotlin.html#sealedclass 

.. _Kotlin Multiplatform: https://kotlinlang.org/docs/multiplatform.html#common-code-for-mobile-and-web-applications
.. _Kotlin Worker: https://kotlinlang.org/docs/native-immutability.html#workers
.. _Kotlin Concurrency overview: https://kotlinlang.org/docs/multiplatform-mobile-concurrency-overview.html
.. _Continuation-passing style: https://en.wikipedia.org/wiki/Continuation-passing_style
.. _Chiusure lessicali: https://it.wikipedia.org/wiki/Chiusura_(informatica)
.. _Canali Kotlin: https://kotlinlang.org/docs/channels.html
.. _Attori Kotlin: https://kotlinlang.org/docs/shared-mutable-state-and-concurrency.html#actors
.. _Asynchronous I/O: https://en.wikipedia.org/wiki/Asynchronous_I/O
.. _Coroutine video: https://www.youtube.com/watch?v=lmRzRKIsn1g  
.. _Coroutines basics: https://kotlinlang.org/docs/coroutines-basics.html#extract-function-refactoring
.. _Deferred values: https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-deferred/

.. _I/O bound: https://it.wikipedia.org/wiki/I/O_bound
.. _Scala: https://en.wikipedia.org/wiki/Scala_(programming_language)
.. _Android: https://en.wikipedia.org/wiki/Android_(operating_system)
.. _Kotlin wikipedia: https://en.wikipedia.org/wiki/Kotlin_(programming_language)
.. _Kotlin org: https://kotlinlang.org/
.. _Kotlin Playgound: https://play.kotlinlang.org/#eyJ2ZXJzaW9uIjoiMS42LjIxIiwicGxhdGZvcm0iOiJqYXZhIiwiYXJncyI6IiIsIm5vbmVNYXJrZXJzIjp0cnVlLCJ0aGVtZSI6ImlkZWEiLCJjb2RlIjoiLyoqXG4gKiBZb3UgY2FuIGVkaXQsIHJ1biwgYW5kIHNoYXJlIHRoaXMgY29kZS5cbiAqIHBsYXkua290bGlubGFuZy5vcmdcbiAqL1xuZnVuIG1haW4oKSB7XG4gICAgcHJpbnRsbihcIkhlbGxvLCB3b3JsZCEhIVwiKVxufSJ9
.. _Kotlin Online: https://play.kotlinlang.org/#eyJ2ZXJzaW9uIjoiMS42LjIxIiwicGxhdGZvcm0iOiJqYXZhIiwiYXJncyI6IiIsIm5vbmVNYXJrZXJzIjp0cnVlLCJ0aGVtZSI6ImlkZWEiLCJjb2RlIjoiLyoqXG4gKiBZb3UgY2FuIGVkaXQsIHJ1biwgYW5kIHNoYXJlIHRoaXMgY29kZS5cbiAqIHBsYXkua290bGlubGFuZy5vcmdcbiAqL1xuZnVuIG1haW4oKSB7XG4gICAgcHJpbnRsbihcIkhlbGxvLCB3b3JsZCEhIVwiKVxufSJ9
.. _Kotlin Documentation: https://kotlinlang.org/docs/kotlin-pdf.html
.. _Kotlin Learning materials:  https://kotlinlang.org/docs/learning-materials-overview.html
.. _Get started with Kotlin: https://kotlinlang.org/docs/getting-started.html
.. _Kotlin Basic syntax: https://kotlinlang.org/docs/basic-syntax.html#for-loop

.. _Programmazione funzionale: https://it.wikipedia.org/wiki/Programmazione_funzionale


.. video 5.44

===============================================
KotlinNotes
===============================================

Kotlin nasce nel 2011, per introdurre un nuovo linguaggio per la JVM, ispirato a `Scala`_, con l'oiettivo di una 
compilazione più efficiente. Nel 2020 Kotlin è diventato il linguaggio più usato per lo svluppo di applicazioni Android.

Il supporto per la programmazione multipiattaforma è uno dei principali vantaggi di Kotlin
(si veda  `Kotlin Multiplatform`_ ). 
Riduce il tempo impiegato per scrivere e mantenere lo stesso codice per piattaforme diverse, 
pur mantenendo la flessibilità ei vantaggi della programmazione nativa.

.. image:: ./_static/img/programming/kotlin-multiplatform.png
   :align: center
   :width: 40%


In rete si trova molto materiale relativo a questo linguaggio, che ne permette uno studio efficace. 
Riportiamo qui, per comodità, alcuni riferimenti:

- `Kotlin wikipedia`_: fornisce notizie storiche e dettagli sul linguaggio
- `Kotlin org`_: il sito ufficiale
- `Kotlin Documentation`_: presenta il file pdf della documentazione
- `Get started with Kotlin`_: il sito con tutto quello che c'è da sapere su Kotlin
- `Kotlin Basic syntax`_: panoramica sui costrutti sintattici di Kotlin (parte di `Get started with Kotlin`_)
- `Kotlin Learning materials`_: panoramica sulle risorse utili per lo studio di Koltin (parte di `Get started with Kotlin`_)
- `Kotlin Online`_: permette di eseguire programmi Kotlin


---------------------------------------
Koltin per ISS-72939
---------------------------------------

E' ovvio che la presentazione e lo studio di Kotlin avrebbe bisogno di un congruo numero di ore.
In relazione al corso di *Ingegneria dei Sitemi software*, ci poniamo due obiettivi principali:

#. comprendere il ruolo degli `Attori Kotlin`_ all'interno della classe :ref:`ActorBasic.kt`   
#. fornire informazioni-base utili per scrivere :ref:`CodedQActors` in Kotlin e frasi Kotlin 
   all'interno dei :ref:`modelli eseguibili QAk<Qak specification template>`.

Riportiamo qui i punti salienti per ottenere questi obiettivi:

- elementi essenziali della  sintassi Kotlin
- *classi ed oggetti* in Kotlin
- il supporto Kotlin allo *stile funzionale* (:blue:`chiusure, callbacks e CPS`)
- il supporto Kotlin alla *programmazione asincrona in stile CPS*
- le :blue:`coroutines` Kotlin come 'thread leggeri' che possono essere sospesi senza bloccare il thread che le esegue
- i Kotlin :blue:`channels` come 'code' che consentono *suspending send* e *suspending receive*
- i Kotlin :blue:`Actors` come supporto al modello degli Attori


Il file `kotlinUnibo`_ contiene una introduzione con esempi su questi aspetti, 
tenendo conto di un percorso logico che distingue (al solito) una parte 
relativa alla *organizzazione strutturale* dei programmi, una parte relativa alla 
*esecuzione* (concorrente) di attività e una parte relativa alla *interazione* tra attività.

+++++++++++++++++++++++++++++++++++
La parte strutturale
+++++++++++++++++++++++++++++++++++


#. Kotlin intende promuovere l'idea della `Programmazione funzionale`_ e per cui le :blue:`funzioni` sono gli elementi di base di 
   qualsiasi computazione. 

   - Un :blue:`dato` è concettualmente un valore prodotto da una funzione, il cui tipo viene **inferito**
     (si veda `Data, Types and Variables`_)  
   - Le funzioni sono *oggetti di prima classe* che hanno un tipo, possono essere assegnati a variabili e 
     usati come argomenti di funzioni o come valori di ritorno. (si veda `Functions`_) 

#. Kotlin supporta Object Oriented Programming (OOP)  e fornisce funzionalità come astrazione, incapsulamento, ereditarietà
   ma in modo diverso da Java  (si veda `Classes and Objects in Kotlin`_). di particolare rilevanza:

   - `Kotlin Object`_
   - `Kotlin Class`_
   - `About initializazion`_
   - `Sealed clsss`_
   - `Companion object`_
   - `Inheritance`_
   - `Property delegation`_ ( `Delegated properties`_ )
   - `Enum classes`_  ( `Enum class`_ )

+++++++++++++++++++++++++++++++++++
La parte concorrente
+++++++++++++++++++++++++++++++++++

#. Il runtime Kotlin/Native **non incoraggia** un classico modello di concorrenza orientato ai thread 
   con blocchi di codice che si escludono a vicenda e variabili condizionali, poiché questo modello 
   è noto per essere soggetto a errori e inaffidabile. 
#. Invece dei thread, il runtime Kotlin/Native offre il concetto di :blue:`Worker`: 
   flussi di flusso di controllo eseguiti contemporaneamente con una coda di richiesta associata. 
   I Worker sono molto simili agli attori nell'`Actor Model`_. 

   - un `Kotlin Worker`_ può scambiare oggetti Kotlin con un altro Worker. L'oggetto o è immutabile
     o, se modificabile, è proprietà di un singolo Worker, in modo da garantire un singolo mutator
     ed evitare locking. La proprietà può essere trasferita. Si veda anche `Kotlin Concurrency overview`_.

#. Le `Chiusure lessicali`_ sono spesso usati come :blue:`callbacks` in programmi con asincronismo `I/O bound`_,
   in accordo allo stile di programmazione **CPS** (`Continuation-passing style`_) .
#. Per dare supporto alla *programmazione asincrona* (o *non bloccante*), evitando il noto callback hell
   (si veda `Asynchronous I/O`_), Kotlin introduce il meccanismo delle *coroutines*.
#. Una coroutine (si veda) `Introduction to coroutines`_) è una *istanza di calcolo sospendibile* 
   non vincolata a a nessun thread particolare. 
   Può sospendere la sua esecuzione in un thread e riprendere in un altro.

   .. image:: ./_static/img/programming/coroutines0.png
    :align: center
    :width: 40%
  
   Il concetto si basa sull'idea di sospendere un calcolo senza bloccare un thread 
   (si veda :blue:`suspend function` in `Coroutines basics`_) 
   implementato utilizzando (dietro le quinte) una macchina a stati e ``CPS`` .
   Le coroutines non sono parte del linguaggio e nemmeno della libreria standard; fanno parte di una libreria separata 

+++++++++++++++++++++++++++++++++++
La parte interazione
+++++++++++++++++++++++++++++++++++

#. I `Deferred values`_ forniscono un modo conveniente per trasferire un singolo valore tra coroutine. 
   I `Canali Kotlin`_ forniscono un modo per trasferire un flusso di valori (uno :blue:`stream`).
#. Un *attore Kotlin* è una combinazione di una coroutine, lo stato in essa incapsulato e confinato e un canale 
   per comunicare con altre coroutine.
   Gli `Attori Kotlin`_ promuovono uno stile di programmazione basato su messaggi che supera
   la tradizionale interazione di chiamata di procedura senza perdere in prestazioni.

 

