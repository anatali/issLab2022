
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>RobotCleaner &#8212; iss22 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RobotExplorer" href="RobotExplorer.html" />
    <link rel="prev" title="Actors22" href="Actors22.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="robotcleaner">
<h1>RobotCleaner<a class="headerlink" href="#robotcleaner" title="Permalink to this headline">¶</a></h1>
<section id="aprile-2002-requisiti">
<h2>Aprile 2002: requisiti<a class="headerlink" href="#aprile-2002-requisiti" title="Permalink to this headline">¶</a></h2>
<p>Muovere il <a class="reference internal" href="VirtualRobot.html#virtualrobot"><span class="std std-ref">VirtualRobot</span></a> in modo da coprire tutta la superficie di una stanza vuota.</p>
</section>
<section id="robotcleaner-analisi-dei-requisiti">
<h2>RobotCleaner: analisi dei requisiti<a class="headerlink" href="#robotcleaner-analisi-dei-requisiti" title="Permalink to this headline">¶</a></h2>
<section id="analisi-del-testo">
<h3>Analisi del testo<a class="headerlink" href="#analisi-del-testo" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Il VirtualRobot (detto brevemente robot) è quello introdotto in <a class="reference internal" href="VirtualRobot.html#virtualrobot"><span class="std std-ref">VirtualRobot</span></a>.</p></li>
<li><p>La stanza ha pavimento piano, forma rettangolare ed è delimitata da muri.</p></li>
<li><p>Il robot parte dalla <strong>HOME</strong>, definita come l’angolo formato dai muri denominati <code class="docutils literal notranslate"><span class="pre">wallUp</span></code> e  <code class="docutils literal notranslate"><span class="pre">wallLeft</span></code>.</p></li>
</ul>
<p>I requisiti possono essere meglio specificati come segue:</p>
</section>
<section id="requisiti-funzionali">
<h3>Requisiti funzionali<a class="headerlink" href="#requisiti-funzionali" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><em>Copertura</em>: il robot deve seguire una strategia di movimento che garantisca di
esplorare la superficie in modo completo.</p></li>
<li><p><em>VerificaLavoro</em>: deve essere possibile controllare in modo automatico che la copertura sia stata realizzata.</p></li>
<li><p><em>TipoDelRobot</em>: il committente ha specificato di essere interessato a un sistema che
controlla il <a class="reference internal" href="VirtualRobot.html#virtualrobot"><span class="std std-ref">VirtualRobot</span></a>, ma ha anticipato che in futuro vorrà usare un robot reale.
Al momento però, non siamo obbligati ad affrontare questo requisito.</p></li>
</ol>
</section>
<section id="requisiti-non-funzionali">
<h3>Requisiti non funzionali<a class="headerlink" href="#requisiti-non-funzionali" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><em>Proattività</em>: il robot deve muoversi in modo autonomo fino a compimento del lavoro.</p></li>
<li><p><em>Reattività</em>: il committente ha prospettato la possibilità che il robot sospenda il lavoro
in caso di allarmi o altre condizioni (comandi di un operatore, temperatura ambiente elevata, etc.).
Al momento però, non siamo obbligati ad affrontare requisiti di questo tipo.</p></li>
<li><p><em>Sicurezza</em>: non vi sono requisiti specifici, se non l’assunzione che vi sia un unico programma di controllo.</p></li>
</ol>
</section>
</section>
<section id="robotcleaner-analisi-del-problema">
<h2>RobotCleaner: analisi del problema<a class="headerlink" href="#robotcleaner-analisi-del-problema" title="Permalink to this headline">¶</a></h2>
<p>Come analisti, poniamo in evidenza i seguenti punti.</p>
<section id="il-cuore-del-problema">
<h3>Il cuore del problema<a class="headerlink" href="#il-cuore-del-problema" title="Permalink to this headline">¶</a></h3>
<p>Il problema consiste nel definire un controllore capace di realizzare una strategia di comando sistematica
che permetta di soddisfare i requisiti di <em>Copertura</em> e di  <em>VerificaLavoro</em>.</p>
</section>
<section id="strategia-di-movimento">
<h3>Strategia di movimento<a class="headerlink" href="#strategia-di-movimento" title="Permalink to this headline">¶</a></h3>
<p>Si possono pensare diverse possibili strategie di movimento sistematico che permettono la verifica.
Ad esempio:</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/columnMove.PNG"><img alt="_images/columnMove.PNG" class="align-center" src="_images/columnMove.PNG" style="width: 80%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/spiralmove0.PNG"><img alt="_images/spiralmove0.PNG" class="align-center" src="_images/spiralmove0.PNG" style="width: 80%;" /></a>
</td>
<td><a class="reference internal image-reference" href="_images/OndeConcentriche.PNG"><img alt="_images/OndeConcentriche.PNG" class="align-center" src="_images/OndeConcentriche.PNG" style="width: 80%;" /></a>
</td>
</tr>
</tbody>
</table>
<section id="movimento-per-colonne">
<h4>Movimento per colonne<a class="headerlink" href="#movimento-per-colonne" title="Permalink to this headline">¶</a></h4>
<p>Nel caso della figura di sinistra, il robot lavora ‘per colonne’. In particolare,
procede lungo il muro <code class="docutils literal notranslate"><span class="pre">wallLeft</span></code>  fino a incontrare <code class="docutils literal notranslate"><span class="pre">wallDown</span></code>. Qui gira a sinistra,
fa un <span class="blue">passo laterale</span> di lunghezza adeguaata, poi gira di nuovo  a sinistra e procede diritto verso il
muro <code class="docutils literal notranslate"><span class="pre">wallUp</span></code>; quando lo incontra gira a destra fa un <span class="blue">passo laterale</span>, rigira verso destra e di nuovo
procede verso <code class="docutils literal notranslate"><span class="pre">wallDown</span></code>.</p>
<p><em>CompletamentoLavoro</em>:  durante un <em>passo laterale</em>, il robot incontrerà di sicuro <code class="docutils literal notranslate"><span class="pre">wallRight</span></code>:
come ultima mossa procede lungo
tale muro fino a che non incontra di nuovo un muro (<code class="docutils literal notranslate"><span class="pre">wallUp</span></code> o  <code class="docutils literal notranslate"><span class="pre">wallDown</span></code>) e qui si ferma,
considerando terminato il lavoro.</p>
<p><em>VerificaLavoro</em>:  consiste nel tenere traccia del numero di passi laterali compiuti lungo il muro
<code class="docutils literal notranslate"><span class="pre">wallDown</span></code>. Se ogni passo copre una distanza  DR pari alla lunghezza del robot, il numero totale
dei passi da compiere è <code class="docutils literal notranslate"><span class="pre">DWallDown/DR</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
</section>
<section id="movimento-a-spirale">
<h4>Movimento a spirale<a class="headerlink" href="#movimento-a-spirale" title="Permalink to this headline">¶</a></h4>
<p>Nel caso della figura di centro, il robot procede coprendo aree quadrate di lato <code class="docutils literal notranslate"><span class="pre">DR*N</span></code>, con <code class="docutils literal notranslate"><span class="pre">N=1,2,..,M</span></code>.
Questa strategia risulta facile da realizzare per stanza quadrate o quasi, ma è più complicata per
stanza rettangolari con lati di lunghezza diversa tra loro.</p>
</section>
<section id="movimento-a-onde">
<h4>Movimento a onde<a class="headerlink" href="#movimento-a-onde" title="Permalink to this headline">¶</a></h4>
<p>Nel caso della figura di destra, il robot segue i bordi della stanza, riducendo via via il lati della stanza di
DR, lavrando in una ‘stanza virtuale’ di lati <code class="docutils literal notranslate"><span class="pre">DWallDown</span> <span class="pre">-</span> <span class="pre">N*DR</span></code> e <code class="docutils literal notranslate"><span class="pre">DWallLeft</span> <span class="pre">-</span> <span class="pre">N*DR</span></code>, con <code class="docutils literal notranslate"><span class="pre">N=1,2,..,M</span></code>.</p>
<p><em>CompletamentoLavoro</em>:   quando la stanza virtuale perde una dimensione, il robot deve coprire quallo che rimane.</p>
<p><em>VerificaLavoro</em>: se la parte che rimane ha lato <code class="docutils literal notranslate"><span class="pre">L</span> <span class="pre">&gt;</span> <span class="pre">DR</span></code>, può risultare complicato</p>
<p><span class="remark">come analisti, riteniamo adeguata la strategia di lavoro per colonne</span></p>
</section>
</section>
<section id="il-passo-del-robot">
<h3>Il passo del robot<a class="headerlink" href="#il-passo-del-robot" title="Permalink to this headline">¶</a></h3>
<p>In ogni caso, osserviamo che tutte le strategie di lavoro esaminate si basano su una stessa ipotesi:</p>
<p><span class="remark">il robot si muove per passi di lunghezza DR</span></p>
<p>La lunghezza <strong>DR</strong> può essere defiita come:</p>
<p><span class="remark">DR=diametro del cerchio di raggio minimo che circoscrive il robot</span></p>
<section id="il-robot-come-unita-di-misura">
<h4>Il robot come unità di misura<a class="headerlink" href="#il-robot-come-unita-di-misura" title="Permalink to this headline">¶</a></h4>
<p>In pratica, il robot (cioè <strong>DR</strong>) diventa la <strong>unità di misura per le distanze</strong>.
La stanza stessa può essere pensata come suddivisa in celle quadrate di lato DR.</p>
<a class="reference internal image-reference" href="_images/plant0.PNG"><img alt="_images/plant0.PNG" class="align-center" src="_images/plant0.PNG" style="width: 30%;" /></a>
</section>
</section>
<section id="robotcleaner-interazioni">
<h3>RobotCleaner: Interazioni<a class="headerlink" href="#robotcleaner-interazioni" title="Permalink to this headline">¶</a></h3>
<p>Il <a class="reference internal" href="VirtualRobot.html#virtualrobot"><span class="std std-ref">VirtualRobot</span></a> può ricevere comandi via HTTP o via WS (WebSocket).
Le prospettive delineate dal committente inducono a selezionare l’uso di <a class="reference internal" href="VirtualRobot.html#wsconnection"><span class="std std-ref">WsConnection</span></a>
e quindi di interazioni asincrone.</p>
</section>
<section id="linguaggio-di-comando-da-cril-a-aril">
<h3>Linguaggio di Comando: da cril a aril<a class="headerlink" href="#linguaggio-di-comando-da-cril-a-aril" title="Permalink to this headline">¶</a></h3>
<p>Il <a class="reference internal" href="VirtualRobot.html#virtualrobot"><span class="std std-ref">VirtualRobot</span></a> comprende messaggi in <a class="reference internal" href="VirtualRobot.html#comandi-base-per-il-robot-in-cril"><span class="std std-ref">cril</span></a>. Altri robot potrebbero
richiedere comandi identici concettualmente, ma espressi in una sintassi diversa.
Può essere opportuno introdurre un linguaggio di comando ‘technology-independent’, che qui
denominiamo <span class="blue">aril</span> (<strong>Abstract Robot Interaction Lanaguage</strong>).</p>
<p><span class="worktodo">WORKTODO: formalizzare l’analisi</span></p>
</section>
</section>
<section id="maggio-20022-prototipo-dopo-l-analisi">
<h2>Maggio 20022: prototipo dopo l’analisi<a class="headerlink" href="#maggio-20022-prototipo-dopo-l-analisi" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Occorre definire un <strong>modello</strong> del sistema che descrive in modo ‘formale’ (comprensibile/eseguibile da una macchina)
il risultato che l’analista intende esporre e fornire al progettista come punto di partenza per lo sviluppo.</p></li>
</ul>
<section id="robotcleaner-architettura">
<h3>RobotCleaner: Architettura<a class="headerlink" href="#robotcleaner-architettura" title="Permalink to this headline">¶</a></h3>
<p>Il sistema è formato da un componente proattivo che può essere modellato come un attore che opera in un nodo computazionale.</p>
<p>Utlizzando il (meta)modello <a class="reference internal" href="Attori.html#qakactor22"><span class="std std-ref">QakActor22</span></a>, la specifica formale può essere:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Context22</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pcCtx&quot;</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="s">&quot;8083&quot;</span><span class="p">)</span>
<span class="nd">@Actor22</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">MainActorCleaner</span><span class="p">.</span><span class="na">myName</span><span class="p">,</span> <span class="n">contextName</span> <span class="o">=</span> <span class="s">&quot;pcCtx&quot;</span><span class="p">,</span> <span class="n">implement</span> <span class="o">=</span> <span class="n">RobotCleaner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActorCleaner</span> <span class="p">{</span>
   <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il componente proattivo che definisce la business logic può essere formalizzato come una attore che opera come una
<a class="reference external" href="https://it.wikipedia.org/wiki/Macchina_di_Moore">Macchina di Moore</a></p>
</section>
<section id="robotcleaner-behaviour">
<h3>RobotCleaner Behaviour<a class="headerlink" href="#robotcleaner-behaviour" title="Permalink to this headline">¶</a></h3>
<p>Progetto: <strong>unibo.wenvUsage22</strong>.</p>
<ul>
<li><p>Gli stati dell’automa che opera secondo un <a class="reference internal" href="#movimento-per-colonne"><span class="std std-ref">Movimento per colonne</span></a> sono</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">activate,</span> <span class="pre">start,</span> <span class="pre">goingDown,</span> <span class="pre">turnGoingDown,</span> <span class="pre">goingUp,</span> <span class="pre">turnGoingUp,</span> <span class="pre">lastColumn,</span> <span class="pre">completed,</span> <span class="pre">endJob</span></code></p>
</div></blockquote>
</li>
</ul>
<a class="reference internal image-reference" href="_images/RobotCleanerFsm.PNG"><img alt="_images/RobotCleanerFsm.PNG" class="align-center" src="_images/RobotCleanerFsm.PNG" style="width: 80%;" /></a>
<ul>
<li><p>L’automa invia (stati <code class="docutils literal notranslate"><span class="pre">going..</span></code>) al robot comandi di movimento a passi in avanti  come indicato in <a class="reference internal" href="#il-passo-del-robot"><span class="std std-ref">Il passo del robot</span></a> e di rotazione,
(stati <code class="docutils literal notranslate"><span class="pre">turn..</span></code>)  definiti nella classe <code class="docutils literal notranslate"><span class="pre">VRobotMoves</span></code>.</p></li>
<li><p>La <em>VerificaLavoro</em> prospettata in <a class="reference internal" href="#movimento-per-colonne"><span class="std std-ref">Movimento per colonne</span></a> viene realizzata contando il numero di passi verso <code class="docutils literal notranslate"><span class="pre">wallRight</span></code> che deve
risultare, nello stato  <code class="docutils literal notranslate"><span class="pre">completed</span></code> non inferiore <code class="docutils literal notranslate"><span class="pre">DWallDown/DR</span> <span class="pre">+</span> <span class="pre">1</span></code>. La distanza <code class="docutils literal notranslate"><span class="pre">DWallDown</span></code>
può essere misurata facendo muovere l’automa
per passi lunghi DR da <code class="docutils literal notranslate"><span class="pre">wallLeft</span></code> a <code class="docutils literal notranslate"><span class="pre">wallRight</span></code>. Questi compito può essere svolto da una applicazione ad hoc.</p>
<blockquote>
<div><p><span class="worktodo">WORKTODO: Realizzare una applicazione che calcola DWallDown</span></p>
</div></blockquote>
</li>
<li><p>L’automa comunica con il robot (al momento il <a class="reference internal" href="VirtualRobot.html#virtualrobot"><span class="std std-ref">VirtualRobot</span></a>) in modo asincrono (attraverso una <a class="reference internal" href="VirtualRobot.html#wsconnection"><span class="std std-ref">WsConnection</span></a>)
e riceve dal supporto il messaggio <code class="docutils literal notranslate"><span class="pre">endMoveOk</span></code> oppure <code class="docutils literal notranslate"><span class="pre">endMoveKo</span></code> al termina di ogni movimento e rotazione.</p></li>
<li><p>Il supporto che trasforma le informazioni di <a class="reference internal" href="VirtualRobot.html#wenv"><span class="std std-ref">WEnv</span></a> in messaggi <code class="docutils literal notranslate"><span class="pre">endMoveOk</span></code> o <code class="docutils literal notranslate"><span class="pre">endMoveKo</span></code> è realizzato a livello applicativo
da un POJO, observer di <a class="reference internal" href="VirtualRobot.html#wsconnection"><span class="std std-ref">WsConnection</span></a>, definito dalla classe <code class="docutils literal notranslate"><span class="pre">WsConnApplObserver</span></code> che implementa :ref:IObserver`.</p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WsConnApplObserver</span> <span class="kd">extends</span> <span class="n">WsConnSysObserver</span> <span class="kd">implements</span> <span class="n">IObserver</span><span class="p">{</span>
  <span class="p">...</span>
  <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">String</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">//data : {&quot;endmove&quot;:,,,,&quot;move&quot;:&quot;...&quot;}</span>
   <span class="c1">//data : {&quot;collision&quot;:&quot;...&quot;,&quot;target&quot;:&quot;...&quot;}</span>
   <span class="c1">//Genera SystemData.endMoveOk o SystemData.endMoveKo</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Le transizioni di stato avvegono in conseguenza della ricezione di un messaggio <code class="docutils literal notranslate"><span class="pre">endMoveOk</span></code> oppura <code class="docutils literal notranslate"><span class="pre">endMoveKo</span></code></p></li>
</ul>
<p>Il modello eseguibile è riportato in <code class="docutils literal notranslate"><span class="pre">RobotCleanerAnalisi.java</span></code></p>
<p>Progetto: <strong>unibo.wenvUsage22</strong> code: <em>unibo.wenvUsage22.cleaner.RobotCleanerAnalisi</em>.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RobotCleaner</span> <span class="kd">extends</span> <span class="n">QakActor22FsmAnnot</span><span class="p">{</span>

   <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;activate&quot;</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;start&quot;</span><span class="p">,</span>   <span class="n">msgId</span><span class="o">=</span> <span class="n">SystemData</span><span class="p">.</span><span class="na">startSysCmdId</span>  <span class="p">)</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">activate</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

   <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;start&quot;</span> <span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;goingDown&quot;</span><span class="p">,</span>   <span class="n">msgId</span><span class="o">=</span><span class="s">&quot;endMoveOk&quot;</span>  <span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;endJob&quot;</span><span class="p">,</span>      <span class="n">msgId</span><span class="o">=</span><span class="s">&quot;endMoveKo&quot;</span>  <span class="p">)</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="robotcleaner-progetto">
<h2>RobotCleaner: progetto<a class="headerlink" href="#robotcleaner-progetto" title="Permalink to this headline">¶</a></h2>
<p>Il progettista parte dal modello dell’analisi e inizia con la semplificazione
dell’automa, riducendo il numero degli stati.</p>
<p>Nello stato  <code class="docutils literal notranslate"><span class="pre">coverColumn</span></code> il robot percorre una colonna; la direzione è mantenuta in una variabile
booleana <code class="docutils literal notranslate"><span class="pre">goingDown</span></code>, che viene usata nello stato <code class="docutils literal notranslate"><span class="pre">turn</span></code>  per eseguire uno di due macro-mosse:
<code class="docutils literal notranslate"><span class="pre">turnLeftAndStep</span></code> o <code class="docutils literal notranslate"><span class="pre">turnRightAndStep</span></code>.</p>
<a class="reference internal image-reference" href="_images/RobotCleanerFsmProject.PNG"><img alt="_images/RobotCleanerFsmProject.PNG" class="align-center" src="_images/RobotCleanerFsmProject.PNG" style="width: 100%;" /></a>
<p>Inoltre il progettista decide di permettere la riattivazione del robot dopo che ha completato il lavoro.</p>
</section>
<section id="robotcleaner-reattivo-a-comandi">
<h2>RobotCleaner reattivo a comandi<a class="headerlink" href="#robotcleaner-reattivo-a-comandi" title="Permalink to this headline">¶</a></h2>
<p>Al termine della sprint review, il committente, soddisfatto del lavoro, chiede se sia possibile <span class="blue">realizzare
una nuove funzionalità</span>.</p>
<p><strong>RobotCleaner reattivo</strong>: Estendere il funzionamento di il <a class="reference internal" href="#robotcleaner-behaviour"><span class="std std-ref">RobotClenaer</span></a>
in modo da eseguire i seguenti comandi inviati da un controllore (umano o macchina):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> (id = <code class="docutils literal notranslate"><span class="pre">SystemData.startSysCmdId</span></code>) attiva il robot, che parte dalla posizione HOME</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> (id = <code class="docutils literal notranslate"><span class="pre">SystemData.stopSysCmdId</span></code>): ferma il robot nella posizione corrente</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume</span></code> (id = <code class="docutils literal notranslate"><span class="pre">SystemData.resumeSysCmdId</span></code>): riattiva il robot dalla posizione corrente</p></li>
</ul>
<p>A questo punto si potrebbe pensare alla seguente pianificazione del lavoro:</p>
<ol class="arabic simple">
<li><p>Si estende il behavior introdotto in <a class="reference internal" href="#robotcleaner-behaviour"><span class="std std-ref">RobotCleaner Behaviour</span></a>, tenendo conto dei nuovi possibili messaggi.</p></li>
<li><p>Si realizza una Web User Interface utlizzando SpringBoot. Per questa parte si veda
<a class="reference internal" href="#una-webconsole-per-il-robotcleaner"><span class="std std-ref">Una WebConsole per il RobotCleaner</span></a></p></li>
</ol>
<section id="troppo-precipitosi">
<h3>Troppo precipitosi?<a class="headerlink" href="#troppo-precipitosi" title="Permalink to this headline">¶</a></h3>
<p>Partire con l’idea di procedere lavorando immediatamente su una <strong>estensione  del funzionamento</strong> significa
a <span class="blue">non trattare in modo esplcito</span> due punti importanti:</p>
<ol class="arabic simple">
<li><p>come si modifica l’architettura logica del sistema</p></li>
<li><p>quale è il significato di <span class="blue">fermare e riattivare</span>: dopo uno <code class="docutils literal notranslate"><span class="pre">stop</span></code>, il robot potrebbe dover eseguire altre azioni?</p></li>
</ol>
<section id="la-nuova-architettura-logica">
<h4>La nuova architettura logica<a class="headerlink" href="#la-nuova-architettura-logica" title="Permalink to this headline">¶</a></h4>
<p><span class="worktodo">WORKTODO: impostare un modello (eseguibile) della nuova architettura</span></p>
</section>
<section id="il-significato-di-stop-resume">
<h4>Il significato di stop/resume<a class="headerlink" href="#il-significato-di-stop-resume" title="Permalink to this headline">¶</a></h4>
<p>Il committente chiarisce che il robot, sopo un comando di <code class="docutils literal notranslate"><span class="pre">stop</span></code>, <strong>al momento</strong>,
non deve eseguire alcuna altra azione, se non rimanere in attesa di un <code class="docutils literal notranslate"><span class="pre">resume</span></code>.</p>
<section id="il-nuovo-piano-di-lavoro">
<h5>Il nuovo piano di lavoro<a class="headerlink" href="#il-nuovo-piano-di-lavoro" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li><p>Si realizza un attore che simula l’operatore umano che invia i comandi</p></li>
<li><p>Si verifica il funzionamento del nuovo prototipo</p></li>
<li><p>Al termine, si realizza una WebApplication con SpringBoot.</p></li>
</ol>
<p>Partendo dal modello della analisi, si considera
la possibilità di gestire un messaggio di <code class="docutils literal notranslate"><span class="pre">stop</span></code> negli stati marcati nella figura che segue.</p>
<a class="reference internal image-reference" href="_images/RobotCleanerFsmStartStopAnalisi.PNG"><img alt="_images/RobotCleanerFsmStartStopAnalisi.PNG" class="align-center" src="_images/RobotCleanerFsmStartStopAnalisi.PNG" style="width: 80%;" /></a>
<p>Per una versione di questo tipo si veda</p>
<blockquote>
<div><p>Progetto: <strong>unibo.wenvUsage22</strong> code: <em>unibo.wenvUsage22.cleaner.RobotCleanerStartStop</em>.</p>
</div></blockquote>
<p>Per ogni stato <code class="docutils literal notranslate"><span class="pre">XXX</span></code> marcato, nasce uno stato <code class="docutils literal notranslate"><span class="pre">stoppedXXX</span></code> in cui l’automa transita alla ricezione di un
comando di <code class="docutils literal notranslate"><span class="pre">stop</span></code>. Questo stato rimane in attesa di un comando di <code class="docutils literal notranslate"><span class="pre">resume</span></code>, alla ricezione del
quale transita nello stato <code class="docutils literal notranslate"><span class="pre">resumedXXX</span></code>, che provvede ad elaborare il messaggio  <code class="docutils literal notranslate"><span class="pre">endMoveOk</span></code>
o  <code class="docutils literal notranslate"><span class="pre">endMoveKo</span></code> che avrebbe dovuto provocare una transizione dello stato <code class="docutils literal notranslate"><span class="pre">XXX</span></code>.</p>
<p>Ad esempio:</p>
<a class="reference internal image-reference" href="_images/RobotCleanerFsmStartStopAnalisiNoInterrupt.PNG"><img alt="_images/RobotCleanerFsmStartStopAnalisiNoInterrupt.PNG" class="align-center" src="_images/RobotCleanerFsmStartStopAnalisiNoInterrupt.PNG" style="width: 80%;" /></a>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;stoppedDown&quot;</span> <span class="p">)</span>
<span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;resumedDown&quot;</span><span class="p">,</span>  <span class="n">msgId</span><span class="o">=</span> <span class="n">SystemData</span><span class="p">.</span><span class="na">resumeSysCmdId</span>  <span class="p">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">stoppedDown</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
   <span class="n">outInfo</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;resumedDown&quot;</span> <span class="p">)</span>
<span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;goingDown&quot;</span><span class="p">,</span>     <span class="n">msgId</span><span class="o">=</span><span class="s">&quot;endMoveOk&quot;</span>  <span class="p">)</span>
<span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;turnGoingDown&quot;</span><span class="p">,</span> <span class="n">msgId</span><span class="o">=</span><span class="s">&quot;endMoveKo&quot;</span>  <span class="p">)</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">resumedDown</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
   <span class="n">outInfo</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il progettista potrebbe applicare lo stesso modo di procedere al modello <a class="reference internal" href="#robotcleaner-progetto"><span class="std std-ref">RobotCleaner: progetto</span></a>.</p>
<p>Tuttavia, il progettista si chiede se non sia opportuno un approfondimento dell’analisi del problema,
innescando una retroazione verso l’analista (tipico di un
<a class="reference internal" href="CostruireSoftware.html#l-analisi-del-problema"><span class="std std-ref">processo incrementale, a spirale</span></a>).</p>
</section>
</section>
</section>
<section id="stop-resume-un-nuovo-abstraction-gap">
<h3>Stop/resume: un nuovo abstraction gap?<a class="headerlink" href="#stop-resume-un-nuovo-abstraction-gap" title="Permalink to this headline">¶</a></h3>
<p>La semantica stop/resume delineata in precedenza ricorda il meccanismo delle interruzioni (<span class="blue">interrupt</span>)
che implica:</p>
<ol class="arabic simple">
<li><p>una memorizzazione (nello stack) del stato della CPU</p></li>
<li><p>il trasferimento del controllo alla interrupt-routine e</p></li>
<li><p>il ripristino dello stato salvato al termine di questa, con il ritorno al processo computazionale interrotto.</p></li>
</ol>
<section id="stop-resume-come-interrupt">
<h4>Stop/resume come interrupt<a class="headerlink" href="#stop-resume-come-interrupt" title="Permalink to this headline">¶</a></h4>
<p>Tranedo ispirazione dal meccanismo degli <span class="blue">interrupt</span>, il team di sviluppo ha concordato sulla opportunità
di rendere disponibile un meccanismo analogo da parte della infrastruttura di supporto agli attori, che è stata
così modificata:</p>
<ul class="simple">
<li><p>viene  introdotto un attributo <strong>interrupt</strong> alle transizioni (una sola per stato)</p></li>
<li><p>quando uno stato S ha una transizione con <code class="docutils literal notranslate"><span class="pre">interrupt=true</span></code>, lo si  memorizza prima di passare al prossimo stato.
Si memorizza anche a una copia della tabella delle transizioni che l’automa avrebbe potuto
effettuare in assenza dell’interrupt</p></li>
<li><p>se il prossimo stato (<code class="docutils literal notranslate"><span class="pre">S_I</span></code>) è quello relativo alla transizione qualificata come interrupt,
lo si esegue normalmente, ma alla fine della esecuzione di <code class="docutils literal notranslate"><span class="pre">S_I</span></code>, come ultima operazione si deve eseguire
l’operazione built-in <span class="blue">resume</span>
(una sorta return form interrupt) che ripristina la tabella delle transizioni memorizzata. In tal modo
<code class="docutils literal notranslate"><span class="pre">S_I</span></code> opera come avrebbe fatto <code class="docutils literal notranslate"><span class="pre">S</span></code> se non ci fosse stato l’interrupt, attigendo dai messaggi non gestiti
memoriizzati (<code class="docutils literal notranslate"><span class="pre">OldMsgQueue</span></code>)</p></li>
</ul>
<p>Osserviamo che dallo stato <code class="docutils literal notranslate"><span class="pre">S_I</span></code> si potrebbero avere anche transizioni normali verso altri stati.
Basta che la nuova catena computazionale termini con una <span class="blue">resume</span>.</p>
<p>Con questo meccansimo, il nuovo diagramma di progetto si presenta come segue:</p>
<a class="reference internal image-reference" href="_images/RobotCleanerFsmStartStopProject.PNG"><img alt="_images/RobotCleanerFsmStartStopProject.PNG" class="align-center" src="_images/RobotCleanerFsmStartStopProject.PNG" style="width: 100%;" /></a>
<p>La sua formalizzazione in codice si presenta in qyesto modo:</p>
<blockquote>
<div><p>Progetto: <strong>unibo.wenvUsage22</strong> code: <em>unibo.wenvUsage22.cleaner.RobotCleanerProject</em>.</p>
</div></blockquote>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RobotCleanerInterrupt</span> <span class="kd">extends</span> <span class="n">QakActor22FsmAnnot</span><span class="p">{</span>
 <span class="p">...</span>
   <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;goingDown&quot;</span> <span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;stopped&quot;</span><span class="p">,</span>
        <span class="n">msgId</span><span class="o">=</span><span class="n">SystemData</span><span class="p">.</span><span class="na">stopSysCmdId</span><span class="p">,</span><span class="n">interrupt</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;goingDown&quot;</span><span class="p">,</span>     <span class="n">msgId</span><span class="o">=</span><span class="s">&quot;endMoveOk&quot;</span>  <span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span> <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;turnGoingDown&quot;</span><span class="p">,</span> <span class="n">msgId</span><span class="o">=</span><span class="s">&quot;endMoveKo&quot;</span>  <span class="p">)</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">goingDown</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">outInfo</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">msg</span><span class="p">);</span>
      <span class="n">VRobotMoves</span><span class="p">.</span><span class="na">step</span><span class="p">(</span><span class="n">getName</span><span class="p">(),</span> <span class="n">conn</span> <span class="p">);</span>
   <span class="p">}</span>
   <span class="p">...</span>
   <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;stopped&quot;</span> <span class="p">)</span>
   <span class="nd">@Transition</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;backToInterrupted&quot;</span><span class="p">,</span><span class="n">msgId</span><span class="o">=</span><span class="n">SystemData</span><span class="p">.</span><span class="na">resumeSysCmdId</span><span class="p">)</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">stopped</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">outInfo</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;backToInterrupted&quot;</span> <span class="p">)</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">backToInterrupted</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">outInfo</span><span class="p">(</span><span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">);</span>
      <span class="n">resume</span><span class="p">();</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="una-webconsole-per-il-robotcleaner">
<h2>Una WebConsole per il RobotCleaner<a class="headerlink" href="#una-webconsole-per-il-robotcleaner" title="Permalink to this headline">¶</a></h2>
<p>Ci poniniamo l’obiettivo di creare una <a class="reference internal" href="WebApplications.html#webapplication-con-springboot"><span class="std std-ref">WebApplication con SpringBoot</span></a> che mostri agli utenti una pagina  HTML come quella di figura:</p>
<a class="reference internal image-reference" href="_images/RobotCleanerGui.PNG"><img alt="_images/RobotCleanerGui.PNG" class="align-center" src="_images/RobotCleanerGui.PNG" style="width: 80%;" /></a>
<p><span class="remark">La business logic è nel prototipo RobotCleaner</span></p>
<ul class="simple">
<li><p>Obiettivo della applicazione Spring è solo quello di offrire una GUI. Tutta la logica applicativa è già stata realizzata
(e testata) e può essere resa disponibile mediante un file <code class="docutils literal notranslate"><span class="pre">jar</span></code>.</p></li>
</ul>
<p id="modicreazione"><span class="remark">Chi crea il componente applicativo?</span></p>
<p>Vi sono due modi principali:</p>
<ol class="arabic simple">
<li><p><em>Modo remoto</em>: Il componente applicativo viene allocato su un nodo diverso da quello che ospita l’applicazione Spring</p></li>
<li><p><em>Modo locale</em>: Il componente applicativo viene creato dalla applicazione Spring stessa</p></li>
</ol>
<p><span class="worktodo">WORKTODO: discutere i pro/contro dei due modi</span></p>
<p>In questa sezione continueremo ad usare il progetto denominato <strong>webForActors</strong> introdotto in <a class="reference internal" href="WebApplications.html#primi-passi-con-springboot"><span class="std std-ref">Primi passi con SpringBoot</span></a>.</p>
<section id="robotcleanergui-html">
<h3>RobotCleanerGui.html<a class="headerlink" href="#robotcleanergui-html" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Inseriamo il file <code class="docutils literal notranslate"><span class="pre">RobotCleanerGui.html</span></code> nella directory <strong>templates</strong>.</p></li>
</ul>
<p>Qyesto file definisce la struttura della pagina HTML, suddivisa in due zone:</p>
<ul>
<li><p>area <strong>Condigurazione e comandi</strong>: questa zona realizza un dispositivo  di input, con cui l’utente può inviare comandi al server</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;h4&gt;Commands to the RobotCleaner&lt;/h4&gt;
 ...
  &lt;table&gt;
   &lt;table style=&quot;width:50%&quot;&gt;
   &lt;tbody&gt;
   &lt;!-- the form-data is sent to the page specified in the action attribute --&gt;
   &lt;tr&gt;
   &lt;td &gt; &lt;form action=&quot;robotcmd&quot; method=&quot;post&quot;&gt;&lt;button name=&quot;cmd&quot; value=&quot;t&quot;&gt;start&lt;/button&gt;&lt;/form&gt;&lt;/td&gt;
   &lt;td&gt; &lt;form action=&quot;robotcmd&quot; method=&quot;post&quot;&gt;&lt;button name=&quot;cmd&quot; value=&quot;stop&quot;&gt;stop&lt;/button&gt;&lt;/form&gt;&lt;/td&gt;
   &lt;td&gt; &lt;form action=&quot;robotcmd&quot; method=&quot;post&quot;&gt;&lt;button name=&quot;cmd&quot; value=&quot;resume&quot;&gt;resume&lt;/button&gt;&lt;/form&gt;&lt;/td&gt;
   &lt;/tr&gt;
   &lt;/table&gt;
   &lt;/center&gt;
&lt;/td&gt;
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><ul>
<li><p><strong>Display Area</strong>: questa zona realizza un dispositivo di output, in cui visualizzare informazioni di stato (mediante
una <a class="reference internal" href="WebApplications.html#websocket-in-springboot-versione-base"><span class="std std-ref">WebSocket</span></a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="n">DISPLAY</span> <span class="n">AREA</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;display&quot;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>L’aggiornamento della DisplayArea verrà realizzato da codice JavScript (si veda più avanti: <a class="reference internal" href="#wsminimal-js"><span class="std std-ref">wsminimal.js</span></a>).</p>
</li>
</ul>
</div></blockquote>
</section>
<section id="un-controller-per-la-robotcleaner-appl">
<h3>Un controller per la RobotCleaner Appl<a class="headerlink" href="#un-controller-per-la-robotcleaner-appl" title="Permalink to this headline">¶</a></h3>
<p>Commentiamo l’annotazione <code class="docutils literal notranslate"><span class="pre">&#64;Controller</span></code> in <code class="docutils literal notranslate"><span class="pre">HIControllerDemo</span></code> e inseriamo un nuovo controller <code class="docutils literal notranslate"><span class="pre">HIController</span></code></p>
<div class="highlight-Java notranslate" id="hicontroller"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">it.unibo.webspring.demo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">...</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HIController</span> <span class="p">{</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">robotCmdId</span> <span class="o">=</span> <span class="s">&quot;move&quot;</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span>  <span class="n">String</span> <span class="n">robotName</span>       <span class="o">=</span> <span class="s">&quot;cleaner&quot;</span><span class="p">;</span>

<span class="kd">private</span> <span class="n">String</span> <span class="n">mainPage</span> <span class="o">=</span> <span class="s">&quot;RobotCleanerGui&quot;</span><span class="p">;</span>

<span class="kd">public</span> <span class="nf">HIController</span><span class="p">(){</span>   <span class="p">}</span>
</pre></div>
</div>
<p>Il  controller <code class="docutils literal notranslate"><span class="pre">HIController</span></code>  gestisce:</p>
<ul>
<li><p>le richieste (HTTP-GET) di apertura della pagina:</p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">homePage</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">model</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="s">&quot;arg&quot;</span><span class="p">,</span> <span class="n">appName</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">mainPage</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>le informazioni di configurazione inviate con metodi HTTP-POST, quando l’utente (umano) preme il pulsante <strong>Configure</strong></p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">//Dopo click sul pulsante Configure</span>
<span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/configure&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">configure</span><span class="p">(</span><span class="n">Model</span> <span class="n">viewmodel</span><span class="p">,</span>
         <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">move</span><span class="p">,</span> <span class="n">String</span> <span class="n">addr</span> <span class="p">){</span>
   <span class="n">createRobotCleaner</span><span class="p">();</span>  <span class="c1">//Modo locale per la Business logic:</span>
   <span class="n">ConnQakBase</span> <span class="n">connToRobot</span> <span class="o">=</span>
         <span class="n">ConnQakBase</span><span class="p">.</span><span class="na">create</span><span class="p">(</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span> <span class="p">);</span>
   <span class="n">conn</span> <span class="o">=</span> <span class="n">connToRobot</span><span class="p">.</span><span class="na">createConnection</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">8083</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">mainPage</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La classe <code class="docutils literal notranslate"><span class="pre">ConnQakBase</span></code> è una utility per creare connessioni al Robot con un dato protocollo.</p>
<a class="reference internal image-reference" href="_images/RobotCleanerFsmStartStopProject.PNG"><img alt="_images/RobotCleanerFsmStartStopProject.PNG" class="align-center" src="_images/RobotCleanerFsmStartStopProject.PNG" style="width: 80%;" /></a>
</div></blockquote>
</li>
<li><p>i comandi inviati con metodi HTTP-POST, quando l’utente (umano) preme i pulsanti <strong>start / stop / resume</strong></p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">//Dopo click sul pulsante start/stop/resume</span>
<span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/robotcmd&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">doMove</span><span class="p">(</span><span class="n">Model</span> <span class="n">viewmodel</span><span class="p">,</span> <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">cmd</span><span class="p">){</span>
   <span class="k">if</span><span class="p">(</span> <span class="n">cmd</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">)){</span>  <span class="c1">//Start</span>
         <span class="n">Qak22Util</span><span class="p">.</span><span class="na">sendAMsg</span><span class="p">(</span> <span class="n">SystemData</span><span class="p">.</span><span class="na">startSysCmd</span><span class="p">(</span><span class="s">&quot;hicontroller&quot;</span><span class="p">,</span><span class="n">robotName</span><span class="p">)</span> <span class="p">);</span>
   <span class="p">}</span><span class="k">else</span><span class="p">{</span>
         <span class="k">try</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">moveAril</span><span class="p">(</span><span class="n">cmd</span><span class="p">).</span><span class="na">toString</span><span class="p">();</span>
            <span class="n">conn</span><span class="p">.</span><span class="na">forward</span><span class="p">(</span> <span class="n">msg</span> <span class="p">);</span>
         <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{...</span> <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">mainPage</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notiamo che:</p>
<ul>
<li><p>il pulsante  <strong>start</strong>   invia un comando (<code class="docutils literal notranslate"><span class="pre">cmd</span></code>)  con valore  <strong>t</strong>,  a fronte della form HTML</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;robotcmd&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">button</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cmd&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="o">&gt;</span><span class="n">start</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>i pulsanti  <strong>stop/resume</strong>   inviano un comando (<code class="docutils literal notranslate"><span class="pre">move</span></code>)  con valore uguale al nome del pulsante:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;robotcmd&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">button</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cmd&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;stop&quot;</span><span class="o">&gt;</span><span class="n">stop</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="robotcleaner-display-area">
<h2>RobotCleaner:  display area<a class="headerlink" href="#robotcleaner-display-area" title="Permalink to this headline">¶</a></h2>
<p>Affrontiamo ora un nuovo requisito:</p>
<ul class="simple">
<li><p><strong>DisplayaAreaUpdate</strong>: Il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> deve fornire informazioni di stato che la pagina Web deve visualizzare nella DisplayArea.</p></li>
</ul>
<section id="displayarea-analisi-del-problema">
<h3>DisplayArea: analisi del problema<a class="headerlink" href="#displayarea-analisi-del-problema" title="Permalink to this headline">¶</a></h3>
<p>La nostra analsisi parte tenendo conto dei seguenti vincoli (<strong>requisiti non funzionali</strong>):</p>
<ol class="arabic simple">
<li><p>Per i principi delle  <a class="reference external" href="https://clevercoder.net/2018/09/08/clean-architecture-summary-review">CleanArchitecture</a>, il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> non deve avere conoscenza di questo nuovo requisito e non deve avere alcuna
dipendenza verso la parte Web.</p></li>
<li><p>L’aggiornamernto della pagina Web dovrebbe avvenire in modo asincrono, senza ricorso al polling.</p></li>
</ol>
<p>Questi due vincoli, presi insieme, implicano che:</p>
<ul class="simple">
<li><p>il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> non deve rispondere a richieste volte a conoscere  il proprio stato. Piuttosto deve essere un ente <strong>osservabile</strong>, cioè
capace di emettere informazioni utili per componenti software interessati, anche <strong>‘alieni’</strong>, cioè non-attori;</p></li>
<li><p>il WebServer, responsabile dell’aggiornamento della pagina Web, dovrebbe operare come un ‘alieno’, osservatore del  <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code>;</p></li>
<li><p>in quanto osservatore interessato alle informazioni emesse dal <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code>, il WebServer non deve essere vincolato a risiedere
sullo stesso nodo di elaborazione  del <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code></p></li>
<li><p>la pagina Web deve essere aggiornata usando le <a class="reference external" href="https://it.wikipedia.org/wiki/WebSocket">WebSocket</a></p></li>
</ul>
</section>
<section id="displayarea-architettura">
<h3>DisplayArea: architettura<a class="headerlink" href="#displayarea-architettura" title="Permalink to this headline">¶</a></h3>
<p>L’architettura logica di riferimento può essere rappresentata come nella figura che segue:</p>
<a class="reference internal image-reference" href="_images/RobotCleanerGuiArch.PNG"><img alt="_images/RobotCleanerGuiArch.PNG" class="align-center" src="_images/RobotCleanerGuiArch.PNG" style="width: 60%;" /></a>
<p>Il componente <a class="reference internal" href="WebApplications.html#il-gestore-websockethandler"><span class="std std-ref">WebSocketHandler</span></a> nasce da quanto esposto in
<a class="reference internal" href="WebApplications.html#configurazione-con-websocketconfigurer"><span class="std std-ref">Configurazione con WebSocketConfigurer</span></a> (si veda <a class="reference internal" href="#configurazione-lato-server"><span class="std std-ref">Configurazione lato Server</span></a> ).</p>
</section>
<section id="displayarea-piano-di-lavoro">
<h3>DisplayArea: piano di lavoro<a class="headerlink" href="#displayarea-piano-di-lavoro" title="Permalink to this headline">¶</a></h3>
<p>Al termine della analisi, riteniamo opportuno proporre il seguente piano di lavoro:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SPRINT1(ws)</span></code>: impostare il WebServer in modo da utilizzare connessioni mediante WebSocket con i client collegati, mediante
il framework SpringBoot (a tal fine si veda <a class="reference internal" href="WebApplications.html#websocket-in-springboot-versione-base"><span class="std std-ref">WebSockets in SpringBoot</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SPRINT2(udapte)</span></code>: realizzare il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> come emettitore di eventi percepibli dal WebServer.</p></li>
</ol>
<p>Gli obiettivi (<em>Goals</em>) di ciascun SPRINT, possono essere definiti come segue:</p>
<ul class="simple">
<li><p>nello <code class="docutils literal notranslate"><span class="pre">SPRINT1(ws)</span></code>: realizzare il file <code class="docutils literal notranslate"><span class="pre">wsminimal.js</span></code>, il componente <code class="docutils literal notranslate"><span class="pre">WebSocketHandler</span></code> e verificare che il
WebServer sia in grado di inviare informazioni sulla DisplayArea;</p></li>
<li><p>nello <code class="docutils literal notranslate"><span class="pre">SPRINT2(update)</span></code>: realizzare un meccanismo/supporto che permetta all’attore <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> di emettere
informazioni che possano essere ricevute dal WebServer (in particolare dal <code class="docutils literal notranslate"><span class="pre">WebSocketHandler</span></code>) in modo
che possano essere visualizzate nella DisplayArea. Nella figura della architettura, questo meccanismo è
relativo alla freccia tratteggiata.</p></li>
</ul>
<p>La <span class="blue">valutazione di complessità</span> ci porta a indicare lo  <code class="docutils literal notranslate"><span class="pre">SPRINT2(update)</span></code> come più rischioso e difficile, in quanto
richiede progettazione ad hoc, mentre lo <code class="docutils literal notranslate"><span class="pre">SPRINT1(ws)</span></code> richiede ‘solo’ lo studio delle
<a class="reference internal" href="WebApplications.html#websocket-in-springboot-versione-base"><span class="std std-ref">WebSockets in SpringBoot</span></a>.</p>
</section>
<section id="sprint1-ws">
<h3>SPRINT1(ws)<a class="headerlink" href="#sprint1-ws" title="Permalink to this headline">¶</a></h3>
<p>Per gestire le due aree (di input/output) introdotte in <a class="reference internal" href="#robotcleanergui-html"><span class="std std-ref">RobotCleanerGui.html</span></a>, la pagina si avvale di <a class="reference external" href="https://www.w3schools.com/jquery/default.asp">jquery</a>
e del codice JavaScript defnito nel file <em>wsminimal.js</em>
con cui la pagina si connette a una WebSocket su <code class="docutils literal notranslate"><span class="pre">localhost:8085</span></code> e riceve dati (metodo  <code class="docutils literal notranslate"><span class="pre">onmessage</span></code>)
che visualizza nella <em>Display Area</em>.</p>
<section id="wsminimal-js">
<h4>wsminimal.js<a class="headerlink" href="#wsminimal-js" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const messageWindow   = document.getElementById(&quot;display&quot;);

function sendMessage(message) {
   var jsonMsg = JSON.stringify( {&#39;name&#39;: message});
   socket.send(jsonMsg);
   addMessageToWindow(&quot;Sent Message: &quot; + jsonMsg);
 }

function addMessageToWindow(message) {
   //messageWindow.innerHTML += `&lt;div&gt;${message}&lt;/div&gt;` //add
   messageWindow.innerHTML = `&lt;div&gt;${message}&lt;/div&gt;`  //set
}

function connect(){
   var host       =  &quot;localhost:8085&quot;; //document.location.host;
   var pathname =  &quot;/&quot;//document.location.pathname;
   var addr     = &quot;ws://&quot; +host  + pathname + &quot;socket&quot;  ;
   // Assicura che sia aperta un unica connessione
   if(socket !== undefined &amp;&amp; socket.readyState !== WebSocket.CLOSED){
      alert(&quot;WARNING: Connessione WebSocket già stabilita&quot;);
   }
   var socket = new WebSocket(addr);
   socket.onopen = function (event) {
      addMessageToWindow(&quot;Connected to &quot; + addr);
   };

   socket.onmessage = function (event) {
      addMessageToWindow(&quot;&quot;+`${event.data}`);
   };
   return socket;
}//connect

connect()
</pre></div>
</div>
</section>
<section id="configurazione-lato-server">
<h4>Configurazione lato Server<a class="headerlink" href="#configurazione-lato-server" title="Permalink to this headline">¶</a></h4>
<p>Sul lato del WebServer, SpringBoot impone una <a class="reference internal" href="WebApplications.html#configurazione-con-websocketconfigurer"><span class="std std-ref">Configurazione con WebSocketConfigurer</span></a> che richiede la implementazione
dell’interfaccia <code class="docutils literal notranslate"><span class="pre">WebSocketConfigurer</span></code> e la registrazione di un gestore che estende la casse <code class="docutils literal notranslate"><span class="pre">AbstractWebSocketHandler</span></code>.</p>
<p>La nostra versione della classe <code class="docutils literal notranslate"><span class="pre">WebSocketConfiguration</span></code> che implementa <code class="docutils literal notranslate"><span class="pre">WebSocketConfigurer</span></code>,
offre un metodo static che restituisce il gestore registrato e il wspath:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">WebSocketHandler</span> <span class="n">wshandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebSocketHandler</span><span class="p">();</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">wspath</span>              <span class="o">=</span> <span class="s">&quot;socket&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>In base a questa configurazione, il server risponderà a richieste inviate sulla WebSocket al seguente indirizzo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nl">ws:</span><span class="c1">//&lt;serverIP&gt;:8085/socket</span>
</pre></div>
</div>
</section>
</section>
<section id="iwshandler-e-websockethandler">
<h3>IWsHandler e WebSocketHandler<a class="headerlink" href="#iwshandler-e-websockethandler" title="Permalink to this headline">¶</a></h3>
<p>Il nostro gestore è simile  a quanto introdotto <a class="reference internal" href="WebApplications.html#il-gestore-websockethandler"><span class="std std-ref">Il gestore WebSocketHandler</span></a>; in più implementa la interfaccia:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IWsHandler</span> <span class="p">{</span>
   <span class="kt">void</span> <span class="nf">sendToAll</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il metodo <code class="docutils literal notranslate"><span class="pre">sendToAll</span></code> permette di inviare informazioni a tutti i client collegati attraverso la WebSocket.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSocketHandler</span> <span class="kd">extends</span> <span class="n">AbstractWebSocketHandler</span> <span class="kd">implements</span> <span class="n">IWsHandler</span> <span class="p">{</span>
<span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">WebSocketSession</span><span class="o">&gt;</span> <span class="n">sessions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
 <span class="p">...</span>
   <span class="nd">@Override</span>
   <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">handleTextMessage</span><span class="p">(</span><span class="n">WebSocketSession</span> <span class="n">session</span><span class="p">,</span> <span class="n">TextMessage</span> <span class="n">message</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
      <span class="n">sendToAll</span><span class="p">(</span><span class="s">&quot;echo:&quot;</span><span class="o">+</span><span class="n">message</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
   <span class="p">}</span>

 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendToAll</span><span class="p">(</span><span class="n">TextMessage</span> <span class="n">message</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">{</span>
     <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">WebSocketSession</span><span class="o">&gt;</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">sessions</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span>
     <span class="k">while</span><span class="p">(</span> <span class="n">iter</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()</span> <span class="p">){</span>
         <span class="n">iter</span><span class="p">.</span><span class="na">next</span><span class="p">().</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>Per propagare un messaggio a tutti i client connessi attraverso la WebSocket,  <a class="reference internal" href="WebApplications.html#il-gestore-websockethandler"><span class="std std-ref">Il gestore WebSocketHandler</span></a> tiene traccia
delle sessioni in una struttura dati (<em>sessions</em>).</p>
<section id="displayarea-testing">
<h4>DisplayArea testing<a class="headerlink" href="#displayarea-testing" title="Permalink to this headline">¶</a></h4>
<p>Una prima verifica della soluzione proposta si articola su diverse situazioni:</p>
<ul>
<li><p>in <strong>locale</strong> (entro la pagina): si visualizza un messaggio di avvenuta connessione col server tramite la WebSocket;</p></li>
<li><p>in <strong>remoto</strong> (informazioni da WebServer): si invia un messaggio di avvenuta configurazione
da parte di <a class="reference internal" href="WebApplications.html#configurazione-con-websocketconfigurer"><span class="std std-ref">Configurazione con WebSocketConfigurer</span></a>;</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSocket</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSocketConfiguration</span> <span class="kd">implements</span> <span class="n">WebSocketConfigurer</span> <span class="p">{</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">WebSocketHandler</span> <span class="n">wshandler</span><span class="o">=</span><span class="k">new</span> <span class="n">WebSocketHandler</span><span class="p">();</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">wspath</span>             <span class="o">=</span> <span class="s">&quot;socket&quot;</span><span class="p">;</span>

<span class="kd">public</span> <span class="nf">WebSocketConfiguration</span><span class="p">(){</span>
 <span class="k">new</span> <span class="n">Thread</span><span class="p">(){</span> <span class="c1">//To test ws-connection</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">(){</span>
       <span class="n">wshandler</span><span class="p">.</span><span class="na">sendToAll</span><span class="p">(</span><span class="s">&quot;WebSocketConfiguration created&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
 <span class="p">}.</span><span class="na">start</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>da <strong>programma</strong> (connessioni su Ws): si crea un programma Java che utilizza <a class="reference internal" href="VirtualRobot.html#wsconnection"><span class="std std-ref">WsConnection</span></a>
(la implementazione osservabile di  <a class="reference internal" href="RadarSystemProdottiAnalisi.html#interaction2021"><span class="std std-ref">L’interfaccia Interaction2021</span></a> sulle ws) per inviare comandi al WebServer.</p>
<p>In modo simile al <code class="docutils literal notranslate"><span class="pre">ClientUsingWs</span></code> introdotto in  <a class="reference internal" href="VirtualRobot.html#esempi-di-uso-di-httpconnection-e-wsconnection"><span class="std std-ref">Esempi di uso di HttpConnection e WsConnection</span></a>,
definiamo un client che invia al WebServer la stringa “Hello from remote client”.
Vedremo ricomparire la stringa come echo nella DisplayArea.</p>
<p>Progetto: <strong>webForActors</strong> code: <em>unibo.webForActors.ClientUsingWs</em>.</p>
</li>
</ul>
</section>
</section>
<section id="sprint2-update">
<h3>SPRINT2(update)<a class="headerlink" href="#sprint2-update" title="Permalink to this headline">¶</a></h3>
<p>Dal punto di vista logico, il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> è stato modellato come un emettitore di <a class="reference internal" href="Eventi.html#eventi"><span class="std std-ref">Eventi</span></a>,
ma il sistema si presenta come
<strong>eterogeneo</strong>: infatti non tutti i componenti del sistema seguono il modello ad <a class="reference internal" href="Attori.html#attori"><span class="std std-ref">Attori</span></a>. In particolare:</p>
<p><span class="remark">il WebServer è progettato e costruito ‘al di fuori’ del modello ad  Attori</span></p>
<section id="una-soluzione-sbagliata">
<h4>Una soluzione sbagliata<a class="headerlink" href="#una-soluzione-sbagliata" title="Permalink to this headline">¶</a></h4>
<p>Nel caso in cui il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> sia attivato in <em>Modo locale</em> (si veda <a class="reference internal" href="#modicreazione">modiCreazione</a>), una soluzione
possibile sarebbe introdurre codice supplementare nell’attore. Ad esempio:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RobotCleanerProject</span> <span class="kd">extends</span> <span class="n">QakActor22FsmAnnot</span><span class="p">{</span>
 <span class="p">...</span>
 <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;coverColumn&quot;</span> <span class="p">)</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">coverColumn</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="n">WebSocketConfiguration</span><span class="p">.</span><span class="na">wshandler</span><span class="p">.</span><span class="na">sendToAll</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">msg</span><span class="p">);</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="remark">Questa soluzione funziona ma è errata</span></p>
<p>Infatti crea una dipendenza dell’attore dalla tecnolgia usata per l’aggiornamento delle pagine Web.</p>
</section>
<section id="emettere-e-percepire-informazione-eventi">
<h4>Emettere e percepire informazione (eventi)<a class="headerlink" href="#emettere-e-percepire-informazione-eventi" title="Permalink to this headline">¶</a></h4>
<p>Per evitare che <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> subisca modifiche indebite, potremmo affrontare il problema
dell’osservabilità in tre modi:</p>
<ol class="arabic simple">
<li><p>Rendere <em>‘componenti alieni’</em> capaci di percepire eventi emessi da attori <a class="reference internal" href="Attori.html#actorqak-e-qakactor22"><span class="std std-ref">ActorQak e QakActor22</span></a>.</p></li>
<li><p>Realizzare l’emissione di un evento da parte dell’attore <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> utilizzando un <span class="blue">protocollo  publish-subscribe</span>  come MQTT.
Il WebServer potrebbe iscriversi (<strong>subscribe</strong>) alla topic su cui l’attiore pubblica le informazioni.</p></li>
<li><p>Rendere l’attore <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> una <span class="blue">risorsa CoAP osservabile</span>. Il WebServer potrebbe utlizzare
un <span class="blue">CoAP client</span> per ricevere le informazioni di stato quando sono emeesse.</p></li>
</ol>
<p>La infrastruttura degli attori <code class="docutils literal notranslate"><span class="pre">QakActor22</span></code> è definita in modo da rendere possibili enatrambe le ultime due strade.
La infrastruttura degli attori <code class="docutils literal notranslate"><span class="pre">ActorQak</span></code> rende possibile anche la prima.</p>
<p>In questa sede, ci concentriamo sulla strada meno convenzionale, che
considera le interazioni  tra componenti distribuiti come uno scambio di <strong>rappresentazioni di risorse</strong>
accessibili in stile <a class="reference external" href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>.</p>
<p>Il compito è agevolato dal fatto che ogni attore <a class="reference internal" href="Attori.html#actorqak-e-qakactor22"><span class="std std-ref">ActorQak e QakActor22</span></a> è stato definito in modo da essere
anche una <span class="blue">risorsa CoAP osservabile</span> come descritto in <a class="reference internal" href="AttoriCoap.html#attori-come-risorse-coap"><span class="std std-ref">Attori come risorse CoAP</span></a>.</p>
</section>
</section>
<section id="robotcleaner-come-risorsa-coap">
<h3>RobotCleaner come risorsa CoAP<a class="headerlink" href="#robotcleaner-come-risorsa-coap" title="Permalink to this headline">¶</a></h3>
<p>L’attore che realizza il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> costituisce una <a class="reference internal" href="AttoriCoap.html#attori-come-risorse-coap"><span class="std std-ref">risorsa CoAP-osservabile</span></a> , che viene
aggiornata usando il metodo  <code class="docutils literal notranslate"><span class="pre">updateResourceRep</span></code>. La dipendenza indebita si prima viene così superata come segue:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RobotCleanerProject</span> <span class="kd">extends</span> <span class="n">QakActor22FsmAnnot</span><span class="p">{</span>
 <span class="p">...</span>
 <span class="nd">@State</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;coverColumn&quot;</span> <span class="p">)</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">coverColumn</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="c1">//WebSocketConfiguration.wshandler.sendToAll(&quot;&quot;+msg);</span>
    <span class="n">updateResourceRep</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">msg</span><span class="p">);</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>L’invocazione di <code class="docutils literal notranslate"><span class="pre">updateResourceRep(M)</span></code> provoca l’invio della stringa M a tutti i CoAP client connessi
alla risorsa.</p>
<section id="il-configuratore-mainrobotcleaner">
<h4>Il configuratore MainRobotCleaner<a class="headerlink" href="#il-configuratore-mainrobotcleaner" title="Permalink to this headline">¶</a></h4>
<p>La fase di configurazione sul WebServer che permette l’uso (in <em>modo locale</em> o in <em>modo remoto</em>)
del <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> deve ora  creare un <a class="reference internal" href="#robotcleanerobserver"><span class="std std-ref">RobotCleanerObserver</span></a>
che riceve un riferimento
al <a class="reference internal" href="#iwshandler-e-websockethandler"><span class="std std-ref">WebSocketHandler</span></a> memorizzato in <code class="docutils literal notranslate"><span class="pre">WebSocketConfiguration.wshandler</span></code>.</p>
<p>Introdurremo la  creazione del <a class="reference internal" href="#robotcleanerobserver"><span class="std std-ref">RobotCleanerObserver</span></a> nel metodo di configurazione di <a class="reference internal" href="#hicontroller">HIController</a>:</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="c1">//Dopo click sul pulsante Configure</span>
<span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/configure&quot;</span><span class="p">)</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">configure</span><span class="p">(</span><span class="n">Model</span> <span class="n">viewmodel</span><span class="p">,</span>
            <span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">move</span><span class="p">,</span> <span class="n">String</span> <span class="n">addr</span> <span class="p">){</span>
      <span class="n">createRobotCleaner</span><span class="p">();</span>  <span class="c1">//Modo locale per la Business logic:</span>
      <span class="n">ConnQakBase</span> <span class="n">connToRobot</span> <span class="o">=</span>
            <span class="n">ConnQakBase</span><span class="p">.</span><span class="na">create</span><span class="p">(</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span> <span class="p">);</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="n">connToRobot</span><span class="p">.</span><span class="na">createConnection</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">8083</span><span class="p">);</span>

      <span class="n">RobotCleanaerObserver</span> <span class="n">obs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RobotCleanaerObserver</span><span class="p">(</span><span class="s">&quot;8083&quot;</span><span class="p">,</span><span class="n">robotName</span><span class="p">);</span>
      <span class="n">obs</span><span class="p">.</span><span class="na">setWebSocketHandler</span><span class="p">(</span><span class="n">WebSocketConfiguration</span><span class="p">.</span><span class="na">wshandler</span><span class="p">);</span>

      <span class="k">return</span> <span class="n">mainPage</span><span class="p">;</span>
   <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><span class="remark">Il RobotCleaner non dipende in alcun modo dalla WebApplication</span></p></li>
</ul>
<p>Inoltre:</p>
<ul class="simple">
<li><p><span class="remark">E’ il RobotCleaner che decide quali informazioni rendere visibili</span></p></li>
</ul>
</section>
</section>
<section id="robotcleanerobserver">
<h3>RobotCleanerObserver<a class="headerlink" href="#robotcleanerobserver" title="Permalink to this headline">¶</a></h3>
<p>Il compito dell’osservatore del  <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> è di creare un CoAP-client capace di ricevere le informazioni sui cambiamenti di stato
‘emesse’ dal <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code>
(in quanto  CoAP-resource) e invocare il metodo <code class="docutils literal notranslate"><span class="pre">sendToAll</span></code> del <a class="reference internal" href="#iwshandler-e-websockethandler"><span class="std std-ref">WebSocketHandler</span></a> che
aggiorna la DisplayArea di tutti i client collegati.</p>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RobotCleanaerObserver</span> <span class="p">{</span>
<span class="kd">private</span> <span class="n">CoapObserveRelation</span> <span class="n">relation</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">CoapClient</span> <span class="n">client</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">IWsHandler</span> <span class="n">wsh</span> <span class="p">;</span>

<span class="kd">public</span> <span class="nf">RobotCleanaerObserver</span><span class="p">(</span><span class="n">String</span> <span class="n">port</span><span class="p">,</span> <span class="n">String</span> <span class="n">actorName</span><span class="p">){</span>
 <span class="n">client</span><span class="o">=</span><span class="k">new</span> <span class="n">CoapClient</span><span class="p">(</span><span class="s">&quot;coap://localhost:&quot;</span><span class="o">+</span><span class="n">port</span><span class="o">+</span><span class="s">&quot;/actors/&quot;</span><span class="o">+</span><span class="n">actorName</span><span class="p">);</span>
 <span class="n">observe</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWebSocketHandler</span><span class="p">(</span><span class="n">IWsHandler</span> <span class="n">h</span><span class="p">){</span>
   <span class="n">wsh</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">public</span> <span class="kt">void</span>  <span class="nf">observe</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
   <span class="n">relation</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="na">observe</span><span class="p">(</span>
      <span class="k">new</span> <span class="n">CoapHandler</span><span class="p">()</span> <span class="p">{</span>
         <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLoad</span><span class="p">(</span><span class="n">CoapResponse</span> <span class="n">response</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="na">getResponseText</span><span class="p">();</span>
         <span class="k">if</span><span class="p">(</span> <span class="n">wsh</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="n">wsh</span><span class="p">.</span><span class="na">sendToAll</span><span class="p">(</span><span class="n">content</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onError</span><span class="p">()</span> <span class="p">{</span>
         <span class="n">ColorsOut</span><span class="p">.</span><span class="na">outerr</span><span class="p">(</span><span class="s">&quot;OBSERVING FAILED (press enter to exit)&quot;</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="permanenza-delle-info-nella-displayarea">
<h3>Permanenza delle info nella DisplayArea<a class="headerlink" href="#permanenza-delle-info-nella-displayarea" title="Permalink to this headline">¶</a></h3>
<p>Purtroppo le informazioni inviate sulla WS <strong>non permangono visibili</strong> in quanto la pagina viene aggiornata dopo ogni comando.
Per superare questo problema, possiamo inviare i comandi sulla WS stessa, invece che con HTTP-POST, realizzando di fatto una
forma di Machine-to-machine (M2M) interaction.</p>
<p>Si provi ad esempio ad inserire nella pagina <a class="reference internal" href="#robotcleanergui-html">RobotCleanerGui.html</a> una nuova area-comandi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">COMMAND</span><span class="o">-</span><span class="n">WS</span> <span class="n">AREA</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">button</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;startws&quot;</span> <span class="o">&gt;</span><span class="n">startWs</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">button</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;stopws&quot;</span> <span class="o">&gt;</span><span class="n">stopWs</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">button</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;resumews&quot;</span> <span class="o">&gt;</span><span class="n">resumeWs</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/RobotCleanerGuiPlus.PNG"><img alt="_images/RobotCleanerGuiPlus.PNG" class="align-center" src="_images/RobotCleanerGuiPlus.PNG" style="width: 40%;" /></a>
<p>Il file <a class="reference internal" href="#wsminimal-js">wsminimal.js</a>  vine arricchito con codice <a class="reference external" href="https://www.w3schools.com/jquery/default.asp">jQuery</a> che invia comandi sulla WebSocket:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$(function () { //short-hand for $(document).ready(function() {...});
   $( &quot;#startws&quot; ).click(function() { socket.send(&quot;start&quot;);    })
   $( &quot;#stopws&quot; ).click(function() { socket.send(&quot;stop&quot;);  })
   $( &quot;#resumews&quot; ).click(function() { socket.send(&quot;resume&quot;);  })
});
</pre></div>
</div>
<p>Premendo sui nuovi pulsanti, si vedranno comparire (come echo) i comandi,
ritrasmessi ai client dal metodo <code class="docutils literal notranslate"><span class="pre">handleTextMessage</span></code> di <a class="reference internal" href="#iwshandler-e-websockethandler"><span class="std std-ref">WebSocketHandler</span></a>.</p>
<p><span class="worktodo">WORKTODO: realizzare i comandiWs</span></p>
<ul class="simple">
<li><p>estendere il codice di <code class="docutils literal notranslate"><span class="pre">handleTextMessage</span></code> di <a class="reference internal" href="#iwshandler-e-websockethandler"><span class="std std-ref">WebSocketHandler</span></a> in modo da inviare
gli opportuni messaggi  al <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code>.</p></li>
</ul>
</section>
<section id="nuove-opportunita">
<h3>Nuove opportunità<a class="headerlink" href="#nuove-opportunita" title="Permalink to this headline">¶</a></h3>
<p>Notiamo che, lanciando il programma <code class="docutils literal notranslate"><span class="pre">unibo.webForActors.ClientUsingWs</span></code>, questo visualizzerà tutte le informazioni emesse da
<code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code>.
Cio ci induce ad asserire che:</p>
<ul class="simple">
<li><p><span class="remark">Abbiamo un meccanismo utile per il testing automatizzato</span></p></li>
</ul>
<p><span class="worktodo">WORKTODO: aggiornare un log file delle variazioni di stato del RobotCleaner</span></p>
<ul class="simple">
<li><p>Scrivere un programma Java (etserno alla WebApplication) che crea un Observer della CoAP-resource <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> che aggiorna
un file di log di tutte  le informazioni emesse dal robot.</p></li>
</ul>
</section>
</section>
<section id="robotcleaner-back-to-home">
<h2>RobotCleaner: back to HOME<a class="headerlink" href="#robotcleaner-back-to-home" title="Permalink to this headline">¶</a></h2>
<p>Un <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code> potrebbe dover essere reattivo a comadi o situazioni che non richiedono solo una
momentanea interruzione delle attivtà che sta eseguendo come sua parte proattiva, ma anche
un radicale cambiamento di queste.</p>
<p>Ad esempio, il robot potrebbere ricevere un comando di <code class="docutils literal notranslate"><span class="pre">BacktoToHome</span></code>.</p>
<section id="backtohome-analisi-del-requisito-e-del-problema">
<h3>BackToHome: analisi del requisito e del problema<a class="headerlink" href="#backtohome-analisi-del-requisito-e-del-problema" title="Permalink to this headline">¶</a></h3>
<p>Un comando di ritorno in HOME senza ulteriori indicazioni, potrebbe essere eseguito in modo semplice,
avvaledosi del fatto che il robot potrebbe proseguire lungo la direzione corrente fino a incontrare:</p>
<ul class="simple">
<li><p><em>wallUp</em> : in questo caso il robot si gira sinistra e percorre il borso superiore</p></li>
<li><p><em>wallDown</em> :  in questo caso il robot si gira a destra e percorre prima il borso inferiore e poi il bordo sinistro.</p></li>
</ul>
<p>In altre parole esiste una strategia di soluzione che <strong>non richiede conoscenza</strong> della
posizione corrente del robot e/o il percorso svolto fino a quel punto.</p>
<p>In geenerale però, la <span class="blue">conoscenza del persorso e della posizione</span> potrebbe essere importante e necessaria.
Si pensi ad esempio al caso in cui il committente precisi il requisito nel modo che segue:</p>
<ul class="simple">
<li><p><strong>BackToHomeFast</strong>: al comando <code class="docutils literal notranslate"><span class="pre">returnToHome</span></code>, il robot deve tornare in HOME seguendo il percorso più breve (o, in alternativa,
con il numero minimo di spostamenti)</p></li>
</ul>
<p>Oppure</p>
<ul class="simple">
<li><p><strong>BackToHomeClean</strong>: al comando <code class="docutils literal notranslate"><span class="pre">returnToHome</span></code>, il robot deve tornare in HOME limitando al minimo di ripercorrere il percorso già fatto
(il pavimento pulito) o limtando.</p></li>
</ul>
<p>In generale poi, le applicazioni che richiedono il controllo di un robot mobile (tra cui il <code class="docutils literal notranslate"><span class="pre">RobotCleaner</span></code>) raramente
si svolgono in una stanza vuota; di solito sono presenti vari ostacoli fissi all’interno della stanza.
In questo caso, ammesso che tali ostacoli siano stati opportunamente evitati durante la fase di pulizia,
la strategia di ritono potrebbe complicarsi.</p>
</section>
</section>
<section id="robotmapperboundary">
<h2>RobotMapperBoundary<a class="headerlink" href="#robotmapperboundary" title="Permalink to this headline">¶</a></h2>
<p>Progetto: <strong>webForActors</strong> code: unibo.Robots.mapper.RobotMapperBoundary*.</p>
<p>Un robot che percorre i bordi della stanza (come il <span class="xref std std-ref">BoundaryWalker&lt;BoundaryWalkerAnnot</span>) e che</p>
<ul class="simple">
<li><p>utilizza le features  del pianificatore <a class="reference external" href="../../../../../it.unibo.planner20/userDocs/LabPlanner.html">UniboPlanner</a> per creare una mappa della stanza come matrice di celle quadrate di lunghezza
pari a una <a class="reference internal" href="#il-robot-come-unita-di-misura"><span class="std std-ref">unità robitica</span></a>.</p></li>
<li><p>ha un  comportamento definito come un <a class="reference internal" href="Actors22.html#un-primo-automa-a-stati-finiti"><span class="std std-ref">FSM</span></a> che utilizza le guardie ‘versione Lenzi’</p></li>
<li><p>rende visibile una rappresentazione corrente della mappa  ad ogni cambio di direzione</p></li>
</ul>
<p>Per questa applicazione, il WebServer offre la pagina definita in <code class="docutils literal notranslate"><span class="pre">RobotNaiveGui.html</span></code>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo-unibo.gif" alt="Logo"/>
    
    <h1 class="logo logo-name">iss22</h1>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduzione.html">Introduzione</a></li>
<li class="toctree-l1"><a class="reference internal" href="CostruireSoftware.html">Costruire software</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkspaceSetup.html">WorkspaceSetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystem.html">RadarSystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemAnalisi.html">Analisi del problema</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemProdottiAnalisi.html">Prodotti della analisi</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemProgetto.html">Progettazione e sviluppo</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemSupporti.html">Supporti per comunicazioni</a></li>
<li class="toctree-l1"><a class="reference internal" href="Enablers.html">Abilitatori di comunicazione</a></li>
<li class="toctree-l1"><a class="reference internal" href="ContestiContenitori.html">Contesti-contenitori</a></li>
<li class="toctree-l1"><a class="reference internal" href="SonarObservable.html">Il SonarObservable</a></li>
<li class="toctree-l1"><a class="reference internal" href="Attori.html">Attori</a></li>
<li class="toctree-l1"><a class="reference internal" href="Eventi.html">Eventi</a></li>
<li class="toctree-l1"><a class="reference internal" href="Annotazioni.html">Annotazioni</a></li>
<li class="toctree-l1"><a class="reference internal" href="RaspberrySoftware.html">RaspberrySoftware</a></li>
<li class="toctree-l1"><a class="reference internal" href="RaspBasicCode.html">RaspBasicCode</a></li>
<li class="toctree-l1"><a class="reference internal" href="VirtualRobot.html">VirtualRobot</a></li>
<li class="toctree-l1"><a class="reference internal" href="Actors22.html">Actors22</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RobotCleaner</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aprile-2002-requisiti">Aprile 2002: requisiti</a></li>
<li class="toctree-l2"><a class="reference internal" href="#robotcleaner-analisi-dei-requisiti">RobotCleaner: analisi dei requisiti</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#analisi-del-testo">Analisi del testo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requisiti-funzionali">Requisiti funzionali</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requisiti-non-funzionali">Requisiti non funzionali</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robotcleaner-analisi-del-problema">RobotCleaner: analisi del problema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#il-cuore-del-problema">Il cuore del problema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#strategia-di-movimento">Strategia di movimento</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#movimento-per-colonne">Movimento per colonne</a></li>
<li class="toctree-l4"><a class="reference internal" href="#movimento-a-spirale">Movimento a spirale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#movimento-a-onde">Movimento a onde</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#il-passo-del-robot">Il passo del robot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#il-robot-come-unita-di-misura">Il robot come unità di misura</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#robotcleaner-interazioni">RobotCleaner: Interazioni</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linguaggio-di-comando-da-cril-a-aril">Linguaggio di Comando: da cril a aril</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#maggio-20022-prototipo-dopo-l-analisi">Maggio 20022: prototipo dopo l’analisi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#robotcleaner-architettura">RobotCleaner: Architettura</a></li>
<li class="toctree-l3"><a class="reference internal" href="#robotcleaner-behaviour">RobotCleaner Behaviour</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robotcleaner-progetto">RobotCleaner: progetto</a></li>
<li class="toctree-l2"><a class="reference internal" href="#robotcleaner-reattivo-a-comandi">RobotCleaner reattivo a comandi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#troppo-precipitosi">Troppo precipitosi?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#la-nuova-architettura-logica">La nuova architettura logica</a></li>
<li class="toctree-l4"><a class="reference internal" href="#il-significato-di-stop-resume">Il significato di stop/resume</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#il-nuovo-piano-di-lavoro">Il nuovo piano di lavoro</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stop-resume-un-nuovo-abstraction-gap">Stop/resume: un nuovo abstraction gap?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stop-resume-come-interrupt">Stop/resume come interrupt</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#una-webconsole-per-il-robotcleaner">Una WebConsole per il RobotCleaner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#robotcleanergui-html">RobotCleanerGui.html</a></li>
<li class="toctree-l3"><a class="reference internal" href="#un-controller-per-la-robotcleaner-appl">Un controller per la RobotCleaner Appl</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robotcleaner-display-area">RobotCleaner:  display area</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#displayarea-analisi-del-problema">DisplayArea: analisi del problema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#displayarea-architettura">DisplayArea: architettura</a></li>
<li class="toctree-l3"><a class="reference internal" href="#displayarea-piano-di-lavoro">DisplayArea: piano di lavoro</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sprint1-ws">SPRINT1(ws)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wsminimal-js">wsminimal.js</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configurazione-lato-server">Configurazione lato Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#iwshandler-e-websockethandler">IWsHandler e WebSocketHandler</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#displayarea-testing">DisplayArea testing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sprint2-update">SPRINT2(update)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#una-soluzione-sbagliata">Una soluzione sbagliata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#emettere-e-percepire-informazione-eventi">Emettere e percepire informazione (eventi)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#robotcleaner-come-risorsa-coap">RobotCleaner come risorsa CoAP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#il-configuratore-mainrobotcleaner">Il configuratore MainRobotCleaner</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#robotcleanerobserver">RobotCleanerObserver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#permanenza-delle-info-nella-displayarea">Permanenza delle info nella DisplayArea</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nuove-opportunita">Nuove opportunità</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robotcleaner-back-to-home">RobotCleaner: back to HOME</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#backtohome-analisi-del-requisito-e-del-problema">BackToHome: analisi del requisito e del problema</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#robotmapperboundary">RobotMapperBoundary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="RobotExplorer.html">RobotExplorer</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebApplications.html">WebApplication con SpringBoot</a></li>
<li class="toctree-l1"><a class="reference internal" href="AttoriCoap.html">Attori come risorse CoAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="OltreTcp.html">Oltre TCP</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="Actors22.html" title="previous chapter">Actors22</a></li>
      <li>Next: <a href="RobotExplorer.html" title="next chapter">RobotExplorer</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Antonio Natali.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/RobotCleaner.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>